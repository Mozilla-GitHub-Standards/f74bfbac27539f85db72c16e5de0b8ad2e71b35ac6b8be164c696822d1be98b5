<!DOCTYPE html>
 <!-- ***** BEGIN LICENSE BLOCK *****
   - Version: MPL 1.1
   -
   - The contents of this file are subject to the Mozilla Public License Version
   - 1.1 (the "License"); you may not use this file except in compliance with
   - the License. You may obtain a copy of the License at
   - http://www.mozilla.org/MPL/
   -
   - Software distributed under the License is distributed on an "AS IS" basis,
   - WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
   - for the specific language governing rights and limitations under the
   - License.
   -
   - The Original Code is Raindrop.
   -
   - The Initial Developer of the Original Code is
   - Mozilla Messaging, Inc..
   - Portions created by the Initial Developer are Copyright (C) 2009
   - the Initial Developer. All Rights Reserved.
   -
   - Contributor(s):
   - -->

<html>
<head>
    <title>Firefox Share OAuthorization</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">

    <script src="scripts/requireplugins-jquery-1.4.2.js" charset="utf-8"></script>
    <style>
         .hidden {
             display: none;
         }

         .invisible {
             visibility: hidden;
         }
    </style>
    <script>
        require(["require", "jquery", "blade/url"],
        function (require,   $,        url) {
            var target = window.location.href.split('#')[1];
            if (target && (target === 'oauth_success' || target === 'oauth_failure')) {
                
                //TODO: ideally lock down the domain be location.hostname, but
                //a problem for 127 addresses?
              window.opener.postMessage(target, '*');
              window.close();
            }
            var search = window.location.href.split('?')[1];
            if (search) {
                search = search.split('#')[0];
                var args = url.queryToObject(search);
                if (args['domain']) {
                    $("#domain").attr("value", args['domain']);
                    document.authForm.submit();
                }
            }
        });
    </script>
</head>
<body class="settings">

    <div class="authorize hidden">
        <form name="authForm" action="/api/account/authorize" method="POST">
	 <input type="hidden" name="domain" id="domain" value="">
	 <input type="hidden" name="end_point_success" value="/auth.html#oauth_success">
	 <input type="hidden" name="end_point_auth_failure" value="/auth.html#oauth_failure">
         <button type="submit">send</button>
        </form>

      </div>
      <div style="clear: both"/>
    </div>

    <!-- oauth_success_twitter section -->
    <div class="section oauth_success hidden">
        <div class="row">
            <div class="c1">
                <h4 class="success">Success!</h4>
                <p>Authorization configured</p>
            </div>
        </div>
    </div>

    <!-- oauth_failure_twitter section -->
    <div class="section oauth_failure hidden">
        <div class="row">
            <div class="c1">
                <h4 class="error">Error</h4>
                <p>Authorization Failed</p>
            </div>
        </div>
    </div>

</body>
</html>

